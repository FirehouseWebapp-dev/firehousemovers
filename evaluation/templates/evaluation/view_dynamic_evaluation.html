{% extends "evaluation/base.html" %}
{% load evaluation_tags %}

{% block title %}
  View Evaluation - {{ employee.user.get_full_name }}
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6 bg-[#1a1a1a] rounded-lg shadow-lg text-white">
  <h2 class="text-3xl font-extrabold text-red-500 mb-6">
    {{ evaluation.form.name }} - {{ evaluation.department.title }}
  </h2>

  <p class="mb-6 text-gray-300">
    <strong>Employee:</strong> {{ employee.user.get_full_name }}<br>
    <strong>Week:</strong> {{ week_start }} to {{ week_end }}<br>
    <strong>Department:</strong> {{ evaluation.department.title }}<br>
    <strong>Form:</strong> {{ evaluation.form.name }}<br>
    <strong>Submitted:</strong> {{ evaluation.submitted_at|date:"M j, Y, P" }}
  </p>

  <div class="bg-green-800/20 border border-green-600 rounded-lg p-4 mb-6">
    <div class="flex items-center">
      <i class="fas fa-check-circle text-green-400 text-xl mr-3"></i>
      <span class="text-green-300 font-semibold">Evaluation Completed</span>
    </div>
  </div>

  <div class="space-y-6">
    {% for question in evaluation.form.questions.all %}
      <div class="bg-[#2a2a2a] rounded-lg p-6">
        <h3 class="text-xl font-semibold text-white mb-3">
          {{ question.text }}
          {% if question.required %}<span class="text-red-500">*</span>{% endif %}
        </h3>
        
        {% if question.help_text %}
          <p class="text-sm text-gray-400 mb-4">{{ question.help_text }}</p>
        {% endif %}

        {% with answer=answers|lookup:question.id %}
          <div class="text-lg">
            {% if answer %}
              {% if question.qtype == "stars" or question.qtype == "rating" or question.qtype == "emoji" %}
                <div class="flex items-center">
                  <span class="text-2xl mr-3">
                    {% if question.qtype == "stars" %}
                      ‚≠ê
                    {% elif question.qtype == "emoji" %}
                      {% if answer.int_value == 1 %}üò°
                      {% elif answer.int_value == 2 %}üòï
                      {% elif answer.int_value == 3 %}üòê
                      {% elif answer.int_value == 4 %}üôÇ
                      {% elif answer.int_value == 5 %}üòç
                      {% endif %}
                    {% endif %}
                  </span>
                  <span class="text-white font-semibold">{{ answer.int_value }}</span>
                </div>
              {% elif question.qtype == "bool" %}
                <span class="text-white font-semibold">
                  {% if answer.int_value == 1 %}Yes{% else %}No{% endif %}
                </span>
              {% elif question.qtype == "number" %}
                <span class="text-white font-semibold">{{ answer.int_value }}</span>
              {% elif question.qtype == "select" %}
                <span class="text-white font-semibold">{{ answer.choice_value }}</span>
              {% elif question.qtype == "short" or question.qtype == "long" %}
                <div class="bg-[#1a1a1a] rounded p-3 border border-gray-600">
                  <span class="text-white">{{ answer.text_value|linebreaks }}</span>
                </div>
              {% endif %}
            {% else %}
              <span class="text-gray-500 italic">No answer provided</span>
            {% endif %}
          </div>
        {% endwith %}
      </div>
    {% endfor %}
  </div>

  <div class="flex justify-end space-x-4 pt-6 border-t border-gray-700 mt-8">
    <a href="{% url 'evaluation:dashboard2' %}" class="px-6 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors">
      Back to Dashboard
    </a>
    {% if evaluation.status == "completed" and today <= evaluation.week_end %}
      <a href="{% url 'evaluation:evaluate_dynamic' evaluation.id %}" class="px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors">
        Edit Evaluation
      </a>
    {% endif %}
  </div>
</div>
{% endblock %}
