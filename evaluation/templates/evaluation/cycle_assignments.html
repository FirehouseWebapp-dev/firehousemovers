{% extends "evaluation/base.html" %}
{% load form_tags %}

{% block title %}Cycle Assignments{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold text-red-500 mb-4">{{ cycle.get_cycle_type_display }} • {{ cycle.period_start }} → {{ cycle.period_end }}</h1>

{% if is_reviewer %}
  <p class="text-gray-300 mb-4">You are the reviewer for these managers. Click to complete.</p>
{% else %}
  <p class="text-gray-300 mb-4">These are reviews about you (visible when submitted).</p>
{% endif %}

<div class="space-y-2">
  {% for it in assignments %}
    <div class="bg-[#111] border border-gray-700 rounded p-4 flex items-center justify-between">
      <div>
        {% if is_reviewer %}
          <div class="text-white font-medium">
            {{ it.subject_manager.user.get_full_name|default:it.subject_manager.user.username }}
          </div>
          <div class="text-gray-400 text-sm">Status: {{ it.status|title }}</div>
        {% else %}
          <div class="text-white font-medium">
            Reviewer: {{ it.reviewer.user.get_full_name|default:it.reviewer.user.username }}
          </div>
          <div class="text-gray-400 text-sm">Status: {{ it.status|title }}</div>
        {% endif %}
      </div>

      <div class="flex items-center gap-3">
        {% if is_reviewer and cycle.is_open %}
          <a href="{% url 'evaluation:evaluate_manager' it.id %}"
             class="px-3 py-2 rounded bg-red-500 hover:bg-red-600 text-white text-sm">
            {% if it.status == "completed" %}Edit{% else %}Evaluate{% endif %}
          </a>
        {% elif not is_reviewer and it.status == "completed" %}
          <span class="px-3 py-2 rounded bg-green-600 text-white text-sm">Completed</span>
        {% else %}
          <span class="px-3 py-2 rounded bg-gray-800 text-gray-400 text-sm">Pending</span>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <div class="text-gray-400">No assignments yet.</div>
  {% endfor %}
</div>
{% endblock %}
