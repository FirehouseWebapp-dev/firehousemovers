{% extends "evaluation/base.html" %}
{% load static %}
{% block title %}{{ employee.user.get_full_name }}'s Evaluations{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'evaluation/css/pending_evaluations.css' %}">
<link rel="stylesheet" href="{% static 'evaluation/css/archived_evaluations.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'evaluation/js/employee_evaluations_list.js' %}"></script>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="analytics-header bg-[#1a1a1a] border-b border-gray-700 p-6 mb-6">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <button id="backButton" class="text-red-500 hover:text-red-400">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <div>
                <h1 class="text-3xl font-bold text-red-500 mb-2">{{ employee.user.get_full_name|title }}'s Evaluations</h1>
                <p class="text-gray-400">Complete evaluation history and status</p>
                <div class="flex items-center gap-4 mt-2 text-sm">
                    {% if employee.department %}
                        <div class="text-blue-400">
                            <i class="fas fa-building mr-1"></i>
                            Department: {{ employee.department.title }}
                        </div>
                    {% endif %}
                    {% if employee.manager %}
                        <div class="text-gray-400">
                            <i class="fas fa-user-tie mr-1"></i>
                            Manager: {{ employee.manager.user.get_full_name|title }}
                        </div>
                    {% endif %}
                <div class="text-gray-400">
                    <i class="fas fa-briefcase mr-1"></i>
                    Role: {{ employee.role|title }}
                </div>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <label class="flex items-center gap-2 text-gray-400 cursor-pointer">
                <input type="checkbox" 
                       id="showArchivedToggle" 
                       {% if show_archived %}checked{% endif %}
                       class="w-4 h-4 text-red-600 bg-gray-700 border-gray-600 rounded focus:ring-red-500">
                <span>Show archived</span>
            </label>
        </div>
    </div>
</div>
</div>

<div class="pending-evaluations-page">
    <!-- Progress Section -->
    <div class="progress-section slide-in animation-delay-1">
        <div class="progress-header">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-white font-semibold">Evaluation Summary</h3>
                <div class="flex items-center gap-4 text-sm">
                    <span class="text-gray-400">{{ completed }} of {{ total }} completed</span>
                    {% if overdue > 0 %}
                        <span class="text-orange-500 font-semibold">{{ overdue }} overdue</span>
                    {% endif %}
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar">
                    <div class="progress-fill" data-progress="{{ percent_complete }}"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluations List -->
    {% if evaluations %}
        <div class="evaluation-list">
            {% for eval in evaluations %}
                <div class="evaluation-card card-hover slide-in animation-delay-4 {% if eval.week_end < today and eval.status == 'pending' %}overdue-card{% endif %}">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="user-avatar">
                                    <i class="fas fa-user-tie text-white text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="evaluation-name">
                                        {{ eval.manager.user.get_full_name|title }}
                                    </h3>
                                    <div class="flex items-center gap-1 mt-1">
                                        <span class="department-badge">
                                            <i class="fas fa-building mr-1"></i>
                                            {{ eval.department.title }}
                                        </span>
                                        <span class="form-badge">
                                            <i class="fas fa-file-alt mr-1"></i>
                                            {{ eval.form.name }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="evaluation-info flex items-center gap-3">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>{{ eval.week_start }} to {{ eval.week_end }}</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    {% if eval.week_end < today and eval.status == 'pending' %}
                                        <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                        <span class="text-orange-500 font-semibold">Overdue</span>
                                    {% elif eval.status == 'pending' %}
                                        <i class="fas fa-clock"></i>
                                        <span>Pending</span>
                                    {% else %}
                                        <i class="fas fa-check-circle text-green-500"></i>
                                        <span class="text-green-500">Completed</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            {% if eval.status == 'completed' %}
                                <span class="status-badge-modern status-completed">
                                    <i class="fas fa-check mr-1"></i>
                                    Completed
                                </span>
                                <a href="{% url 'evaluation:view_evaluation' eval.id %}" class="btn-modern">
                                    <i class="fas fa-eye"></i>
                                    View
                                </a>
                                <button class="archive-btn{% if eval.is_archived %} archived{% endif %}" 
                                        data-evaluation-id="{{ eval.id }}" 
                                        data-employee-name="{{ eval.employee.user.get_full_name|title }}"
                                        data-is-archived="{{ eval.is_archived|yesno:'true,false' }}">
                                    {% if eval.is_archived %}
                                        <i class="fas fa-box-open"></i> Unarchive
                                    {% else %}
                                        <i class="fas fa-archive"></i> Archive
                                    {% endif %}
                                </button>
                            {% elif eval.week_end < today %}
                                <span class="status-badge-modern status-overdue">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>
                                    Overdue
                                </span>
                                <span class="text-orange-500 text-sm">Pending Completion</span>
                            {% else %}
                                <span class="status-badge-modern">
                                    <i class="fas fa-clock mr-1"></i>
                                    Pending
                                </span>
                                <span class="text-yellow-500 text-sm">In Progress</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% include 'evaluation/partials/pagination.html' %}
    {% else %}
        <div class="empty-state slide-in">
            <div class="empty-state-icon">
                <i class="fas fa-clipboard-list text-white text-xl"></i>
            </div>
            <h2 class="empty-state-title">No Evaluations</h2>
            <p class="text-gray-400">{{ employee.user.get_full_name|title }} doesn't have any evaluations yet.</p>
        </div>
    {% endif %}
</div>

<!-- Archive Modal -->
<div id="archiveModal" class="archive-modal">
    <div class="modal-content">
        <div class="modal-header">
            <i class="fas fa-archive"></i>
            <h3 id="archiveModalTitle">Archive Evaluation</h3>
        </div>
        <div class="modal-body">
            <p id="archiveModalMessage">Are you sure you want to archive the evaluation for <strong id="employeeName"></strong>?</p>
            <p class="text-sm mt-2">This evaluation will be hidden from the main view but can be restored later.</p>
        </div>
        <div class="modal-footer">
            <button class="modal-btn modal-btn-cancel">Cancel</button>
            <button class="modal-btn modal-btn-archive">Archive</button>
        </div>
    </div>
</div>

<!-- Success Message -->
<div id="successMessage" class="success-message hidden">
    <i class="fas fa-check-circle"></i>
    <span id="successMessageText"></span>
</div>
{% endblock %}

