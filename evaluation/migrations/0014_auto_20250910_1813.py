# Generated by Django 5.1.4 on 2025-09-10 18:13

from django.db import migrations


def fix_star_rating_max_values(apps, schema_editor):
    """Fix existing star and emoji rating questions that have max_value > 5."""
    Question = apps.get_model('evaluation', 'Question')
    
    # Fix star and emoji rating questions with max_value > 5
    rating_questions = Question.objects.filter(qtype__in=['stars', 'emoji'], max_value__gt=5)
    updated_count = 0
    
    for question in rating_questions:
        print(f"Fixing {question.qtype} question '{question.text}' - max_value: {question.max_value} -> 5")
        question.max_value = 5
        question.save(update_fields=['max_value'])
        updated_count += 1
    
    print(f"Fixed {updated_count} star and emoji rating questions with invalid max_value")


def reverse_fix_star_rating_max_values(apps, schema_editor):
    """Reverse migration - no action needed."""
    pass


class Migration(migrations.Migration):

    dependencies = [
        ("evaluation", "0013_alter_evalform_is_active"),
    ]

    operations = [
        migrations.RunPython(
            fix_star_rating_max_values,
            reverse_fix_star_rating_max_values,
        ),
    ]
