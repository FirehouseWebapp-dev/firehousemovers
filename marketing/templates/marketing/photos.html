{% extends "marketing/base.html" %}
{% load static %}

{% block title %}Marketing Photos{% endblock %}

{% block content %}
  <h1 class="text-center text-4xl font-extrabold text-red-600 mb-8">
    M a r k e t i n g &nbsp; P h o t o s
  </h1>

  <form
    id="photo-form"
    method="post"
    enctype="multipart/form-data"
    class="relative max-w-3xl mx-auto mb-16"
  >
    {% csrf_token %}

    <!-- camera + snap -->
    <div class="camera-wrapper">
      <video
        id="video"
        class="camera-video"
        autoplay
        playsinline
      ></video>
      <div id="flash" class="camera-flash"></div>
      <button
        type="button"
        id="snap"
        class="camera-snap"
      >
        <i class="fas fa-camera-alt"></i>
      </button>
    </div>

    <!-- disk-pick button -->
    <button
      type="button"
      id="add-files-btn"
      class="upload-btn"
    >
      Add Existing Photos
    </button>

    <!-- submit -->
    <button
      type="submit"
      class="publish-btn"
    >
      Publish photo/s to the marketing photos
    </button>

    <!-- live previews + remove -->
    <div id="previews" class="photo-previews"></div>

    <!-- hidden file input -->
    <input
      type="file"
      id="id_photos"
      name="photos"
      accept="image/*"
      multiple
      hidden
    >
  </form>

  <!-- already-published carousel -->
  <div class="carousel-wrapper">
    <div class="carousel">
      {% for photo in photos %}
        <div class="carousel-card relative">
          <img
            src="{{ photo.image.url }}"
            alt="Photo {{ forloop.counter }}"
          >

          {% if can_delete %}
            <button
              type="button"
              onclick="openConfirmModal({{ photo.pk }})"
              class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white px-2 py-1 text-sm rounded shadow">
              Delete
            </button>

          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- modal preview -->
  <div id="modal" class="modal">
    <img id="modal-img" src="" alt="Full size photo">
  </div>
  <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
  <div class="bg-[#1c1c1c] text-white rounded-lg shadow-lg p-6 max-w-sm w-full border border-gray-700">
    <h2 class="text-xl font-bold mb-4 text-red-600">Confirm Deletion</h2>
    <p class="mb-6">Are you sure you want to delete this photo? This action cannot be undone.</p>
    <form id="deleteForm" method="post">
      {% csrf_token %}
      <div class="flex justify-end space-x-2">
        <button type="button"
                onclick="closeConfirmModal()"
                class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">
          Cancel
        </button>
        <button type="submit"
                class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
          Delete
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script src="{% static 'marketing/js/photos.js' %}"></script>
  <script>
    function openConfirmModal(photoId) {
      const modal = document.getElementById('confirmModal');
      const form = document.getElementById('deleteForm');
      form.action = `/marketing/photos/${photoId}/delete/`;
      modal.classList.remove('hidden');
    }

    function closeConfirmModal() {
      const modal = document.getElementById('confirmModal');
      modal.classList.add('hidden');
    }
  </script>
{% endblock %}
